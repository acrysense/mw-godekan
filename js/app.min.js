"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // cursor
  var customCursor = document.getElementById('custom-cursor');
  var mouseX = 0,
    mouseY = 0;
  var isScrolling;
  var lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
  document.addEventListener('mousemove', function (e) {
    mouseX = e.clientX - 9;
    mouseY = e.clientY - 9;
    if (e.target.tagName !== 'IFRAME' && !customCursor.classList.contains('visible')) {
      customCursor.classList.add('visible');
    }
  });
  var updateCursor = function updateCursor() {
    customCursor.style.transform = "translate3d(".concat(mouseX, "px, ").concat(mouseY, "px, 0)");
    requestAnimationFrame(updateCursor);
  };
  updateCursor();
  window.addEventListener('scroll', function (e) {
    customCursor.classList.add('scrolling');
    var st = window.pageYOffset || document.documentElement.scrollTop;
    if (st > lastScrollTop) {
      // scroll down
      customCursor.classList.remove('up');
      customCursor.classList.add('down');
    } else {
      // scroll up
      customCursor.classList.remove('down');
      customCursor.classList.add('up');
    }
    lastScrollTop = st <= 0 ? 0 : st;
    clearTimeout(isScrolling);
    isScrolling = setTimeout(function () {
      customCursor.classList.remove('scrolling');
      if (customCursor.classList.contains('up')) {
        customCursor.classList.remove('up');
      } else if (customCursor.classList.contains('down')) {
        customCursor.classList.remove('down');
      }
    }, 200);
  });

  // cursor state's
  document.body.addEventListener('mouseover', function (event) {
    if (event.target.classList.contains('cursor-hover') || event.target.tagName === 'a' || event.target.closest('.cursor-hover') || event.target.closest('a')) {
      customCursor.classList.add('hover');
    }
    if (event.target.classList.contains('cursor-white') || event.target.closest('.cursor-white')) {
      customCursor.classList.add('white');
    }
    if (event.target.classList.contains('.swiper-button-prev') || event.target.closest('.swiper-button-prev')) {
      customCursor.classList.add('left');
    }
    if (event.target.classList.contains('.swiper-button-next') || event.target.closest('.swiper-button-next')) {
      customCursor.classList.add('right');
    }
    if (event.target.classList.contains('.swiper-pagination-bullet') || event.target.closest('.swiper-pagination-bullet')) {
      customCursor.classList.add('hover');
    }
    if (event.target.classList.contains('iframe') || event.target.closest('iframe')) {
      customCursor.classList.remove('visible');
    }
  });
  document.body.addEventListener('mouseout', function (event) {
    if (event.target.classList.contains('cursor-hover') || event.target.tagName === 'a' || event.target.closest('.cursor-hover') || event.target.closest('a')) {
      customCursor.classList.remove('hover');
    }
    if (event.target.classList.contains('cursor-white') || event.target.closest('.cursor-white')) {
      customCursor.classList.remove('white');
    }
    if (event.target.classList.contains('.swiper-button-prev') || event.target.closest('.swiper-button-prev')) {
      customCursor.classList.remove('left');
    }
    if (event.target.classList.contains('.swiper-button-next') || event.target.closest('.swiper-button-next')) {
      customCursor.classList.remove('right');
    }
    if (event.target.classList.contains('.swiper-pagination-bullet') || event.target.closest('.swiper-pagination-bullet')) {
      customCursor.classList.remove('hover');
    }
    if (event.target.classList.contains('iframe') || event.target.closest('iframe')) {
      customCursor.classList.add('visible');
    }
  });
  document.body.addEventListener('click', function (event) {
    customCursor.classList.add('active');
    setTimeout(function () {
      customCursor.classList.remove('active');
    }, 100);
  });

  // mobile menu
  var mobileMenu = document.getElementById('menu');
  var mobileMenuTrigger = document.getElementById('hamburger-toggle');
  if (mobileMenu && mobileMenuTrigger) {
    mobileMenuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenuTrigger.classList.remove('is--active');
        mobileMenu.classList.remove('is--active');
        document.body.classList.remove('scroll-disabled');
      } else {
        mobileMenuTrigger.classList.add('is--active');
        mobileMenu.classList.add('is--active');
        document.body.classList.add('scroll-disabled');
      }
    });
  }

  // language
  var languageBtns = document.querySelectorAll('.c-language__btn');
  if (languageBtns) {
    languageBtns.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var activeLanguage = document.querySelector('.c-language__btn.is--active').dataset.lang;
        document.querySelectorAll('.c-language__btn').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        if (activeLanguage == 'en') {
          document.querySelectorAll('.c-language__btn[data-lang="ru"]').forEach(function (child) {
            return child.classList.add('is--active');
          });
        } else if (activeLanguage == 'ru') {
          document.querySelectorAll('.c-language__btn[data-lang="en"]').forEach(function (child) {
            return child.classList.add('is--active');
          });
        }
      });
    });
  }

  // about tabs
  var aboutTabsItems = document.querySelectorAll('.about__item');
  if (aboutTabsItems) {
    aboutTabsItems.forEach(function (item, i) {
      item.addEventListener('click', function () {
        var parent = item.closest('.about');
        parent.querySelectorAll('.about__item').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        parent.querySelectorAll('.about__heading').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        item.classList.add('is--active');
        parent.querySelectorAll('.about__heading')[i].classList.add('is--active');
      });
    });
  }

  // iframe loading
  var contentVideoIframe = document.querySelectorAll('.content-video__media');
  if (contentVideoIframe) {
    contentVideoIframe.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = item.closest('.content-video');
        if (!parent.classList.contains('is--active')) {
          parent.classList.add('is--active');
          var frame = parent.querySelector('iframe');
          var link = frame.dataset.src + '&autoplay=1';
          frame.setAttribute('src', link);
          frame.removeAttribute('data-src');
        }
      });
    });
  }

  // types activities
  var typesActivitiesGroup = document.querySelectorAll('.types-activities__group');
  if (typesActivitiesGroup) {
    typesActivitiesGroup.forEach(function (item) {
      item.addEventListener('mouseover', function () {
        item.querySelectorAll('.types-activities__hover').forEach(function (rect) {
          rect.style.fill = '#DCC7B3';
        });
      });
      item.addEventListener('mouseout', function () {
        item.querySelectorAll('.types-activities__hover').forEach(function (rect) {
          rect.style.fill = 'black';
        });
      });
    });
  }

  // approach
  var items = document.querySelectorAll('.approach__item');
  var observer = new IntersectionObserver(function (entries) {
    entries.forEach(function (entry) {
      var target = entry.target,
        intersectionRatio = entry.intersectionRatio;
      var opacity = 0.3 + intersectionRatio * 0.7;
      target.style.opacity = opacity;
    });
  }, {
    threshold: Array.from({
      length: 101
    }, function (_, i) {
      return i / 100;
    })
  });
  items.forEach(function (item) {
    return observer.observe(item);
  });

  // projects inner slider
  var projectsInnerSlider = document.querySelector('.projects-inner__slider .swiper');
  if (projectsInnerSlider) {
    var myProjectsInnerSlider = new Swiper(projectsInnerSlider, {
      slidesPerView: 1,
      loop: true,
      allowTouchMove: false,
      speed: 800,
      parallax: true,
      watchSlidesProgress: true,
      pagination: {
        el: '.projects-inner__slider .swiper-pagination',
        type: 'bullets',
        clickable: true
      },
      navigation: {
        prevEl: '.projects-inner__slider .swiper-button-prev',
        nextEl: '.projects-inner__slider .swiper-button-next'
      }
    });
  }
});